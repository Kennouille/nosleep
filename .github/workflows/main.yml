name: Supabase User Action
on:
  schedule:
    - cron: '0 8 */3 * *'
  workflow_dispatch:

jobs:
  simulate-user:
    runs-on: ubuntu-latest
    steps:
      - name: Installer dépendances
        run: |
          npm init -y
          npm install @supabase/supabase-js

      - name: Simuler un utilisateur et une action
        env:
          SUPABASE_URL: ${{ secrets.SUPABASE_URL }}
          SUPABASE_ANON_KEY: ${{ secrets.SUPABASE_ANON_KEY }}
        run: |
          node -e "
          const { createClient } = require('@supabase/supabase-js');
          const supabase = createClient(process.env.SUPABASE_URL, process.env.SUPABASE_ANON_KEY);
          
          (async () => {
            // Lire des données (action)
            const { data, error } = await supabase
              .from('w_articles')
              .select('*')
              .limit(5);
            
            if (error) throw error;
            console.log(\`✅ Lecture de \${data.length} articles\`);
            
            // Lire une autre table pour plus d'activité
            const { data: projets, error: error2 } = await supabase
              .from('w_projets')
              .select('*')
              .limit(5);
            
            if (!error2) {
              console.log(\`✅ Lecture de \${projets.length} projets\`);
            }
            
            console.log('✅ Session utilisateur avec actions terminée');
          })().catch(console.error);
          "
